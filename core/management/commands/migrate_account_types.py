from django.core.management.base import BaseCommand
from core.models import Ref_Account_Type

class Command(BaseCommand):
    help = 'Migrate account type data to ref_account_type table'

    def handle(self, *args, **options):
        # Account type data
        account_types_data = [
            (3, '1201', 'Дансны авлага', 4, 0, True),
            (4, '1202', 'Татвар, НДШ – ийн авлага', 5, 0, True),
            (5, '1203', 'Бусад авлага', 6, 0, True),
            (6, '1204', 'НӨАТ-ын авлага', 5, 0, True),
            (7, '1301', 'Бусад санхүүгийн хөрөнгө', 10, 0, True),
            (8, '1401', 'Бараа материал', 8, 0, True),
            (9, '1402', 'Хангамж', 8, 0, True),
            (10, '1403', 'Дуусаагүй үйлдвэрлэл', 8, 0, True),
            (11, '1404', 'Бэлэн бүтээгдэхүүн', 8, 0, True),
            (12, '1501', 'Урьдчилж төлсөн зардал/тооцоо', 9, 0, True),
            (13, '1601', 'Бусад эргэлтийн хөрөнгө', 10, 0, True),
            (14, '1701', 'Борлуулах зорилгоор эзэмшиж буй эргэлтийн бус хөрөнгө (борлуулах бүлэг хөрөнгө)', 11, 0, True),
            (15, '2010', 'Барилга', 15, 0, True),
            (16, '2011', 'Барилгын хуримтлагдсан элэгдэл', 15, 0, True),
            (17, '2012', 'Барилгын хуримтлагдсан үнэ цэнийн бууралт', 15, 0, True),
            (18, '2020', 'Тоног төхөөрөмж', 15, 0, True),
            (19, '2021', 'Тоног төхөөрөмжийн хуримтлагдсан элэгдэл', 15, 0, True),
            (20, '2022', 'Тоног төхөөрөмжийн хуримтлагдсан үнэ цэнийн бууралт', 15, 0, True),
            (21, '2030', 'Тээврийн хэрэгсэл', 15, 0, True),
            (22, '2031', 'Тээврийн хэрэгсэлийн хуримтлагдсан элэгдэл', 15, 0, True),
            (23, '2032', 'Тээврийн хэрэгсэлийн хуримтлагдсан үнэ цэнийн бууралт', 15, 0, True),
            (24, '2040', 'Тавилга, эд хогшил', 15, 0, True),
            (25, '2041', 'Тавилга, эд хогшилын хуримтлагдсан элэгдэл', 15, 0, True),
            (26, '2042', 'Тавилга, эд хогшилын хуримтлагдсан үнэ цэнийн бууралт', 15, 0, True),
            (27, '2050', 'Компьютер', 15, 0, True),
            (28, '2051', 'Компьютерын хуримтлагдсан элэгдэл', 15, 0, True),
            (29, '2052', 'Компьютерын хуримтлагдсан үнэ цэнийн бууралт', 15, 0, True),
            (30, '2060', 'Бусад эргэлтийн бус хөрөнгө', 15, 0, True),
            (31, '2061', 'Бусад эргэлтийн бус хөрөнгө  хуримтлагдсан элэгдэл', 15, 0, True),
            (32, '2062', 'Бусад эргэлтийн бус хөрөнгө хуримтлагдсан үнэ цэнийн бууралт', 15, 0, True),
            (33, '2101', 'Дуусаагүй барилга', 15, 0, True),
            (34, '2110', 'Биет бус хөрөнгө', 16, 0, True),
            (35, '2111', 'Биет бус хөрөнгө хуримтлагдсан элэгдэл', 16, 0, True),
            (36, '2112', 'Биет бус хөрөнгө хуримтлагдсан үнэ цэнийн бууралт', 16, 0, True),
            (37, '2201', 'Урт хугацаат  хөрөнгө оруулалт', 18, 0, True),
            (38, '2301', 'Хайгуул ба үнэлгээний хөрөнгө', 19, 0, True),
            (39, '2401', 'Биологийн хөрөнгө', 17, 0, True),
            (40, '2501', 'Хойшлогдсон татварын хөрөнгө', 20, 0, True),
            (41, '2601', 'Хөрөнгө оруулалтын зориулалттай үл хөдлөх хөрөнгө', 21, 0, True),
            (42, '3101', 'Дансны өглөг', 29, 0, True),
            (43, '3201', 'Урьдчилж орсон орлого', 36, 0, True),
            (44, '3301', 'Цалингийн  өглөг', 30, 0, True),
            (45, '3401', 'Татварын өр', 31, 0, True),
            (46, '3402', 'НДШ - ийн  өглөг', 32, 0, True),
            (47, '3403', 'НӨАТ-ын өглөг', 31, 0, True),
            (48, '3501', 'Богино хугацаат зээл', 33, 0, True),
            (49, '3502', 'Хүүний  өглөг', 34, 0, True),
            (50, '3503', 'Даатгалын өглөг', 38, 0, True),
            (51, '3601', 'Ногдол ашгийн  өглөг', 35, 0, True),
            (52, '3701', 'Нөөц  /өр төлбөр/', 37, 0, True),
            (53, '3801', 'Бусад богино хугацаат өр төлбөр', 38, 0, True),
            (54, '3901', 'Борлуулах зорилгоор эзэмшиж буй эргэлтийн бус хөрөнгө (борлуулах бүлэг хөрөнгө) - нд хамаарах өр төлбөр', 39, 0, True),
            (55, '4001', 'Урт хугацаат зээл', 43, 0, True),
            (56, '4003', 'Хойшлогдсон татварын өр ', 45, 0, True),
            (57, '4004', 'Бусад урт хугацаат өр төлбөр', 46, 0, True),
            (58, '4005', 'Урт хугацаат өр төлбөр', 46, 0, True),
            (59, '4101', 'төрийн өмч', 51, 0, True),
            (60, '4102', 'хувийн өмч', 52, 0, True),
            (61, '4103', 'Хувьцаа', 53, 0, True),
            (62, '4104', 'Халаасны хувьцаа', 54, 0, True),
            (63, '4201', 'Нэмж төлөгдсөн капитал', 55, 0, True),
            (64, '4301', 'Хөрөнгийн дахин үнэлгээний нэмэгдэл', 56, 0, True),
            (65, '4401', 'Гадаад валютын хөрвүүлэлтийн нөөц', 57, 0, True),
            (66, '4402', 'Эздийн өмчийн бусад хэсэг', 58, 0, True),
            (67, '4601', 'Хуримтлагдсан ашиг', 59, 0, True),
            (68, '4602', 'Тайлант үеийн ашиг', 59, 0, True),
            (69, '5101', 'Борлуулалтын орлого', 0, 1, True),
            (70, '5102', 'Эрхийн шимтгэлийн орлого', 0, 7, True),
            (71, '5103', 'Даатгалын нөхвөрөөс хүлээн авсан мөнгө', 0, 8, True),
            (72, '5104', 'Татаас, санхүүжилтийн орлого', 0, 8, True),
            (73, '5105', 'Түрээсийн орлого', 0, 4, True),
            (74, '5106', 'Хүүний орлого', 0, 5, True),
            (75, '5107', 'Ногдол ашгийн орлого', 0, 6, True),
            (76, '5108', 'Хүлээн авсан хүүний орлого', 0, 8, True),
            (77, '5201', 'Бусад орлого', 0, 8, True),
            (78, '5301', 'Гадаад валютын ханшийн зөрүүний  олз ', 0, 13, True),
            (79, '5302', 'Гадаад валютын ханшийн зөрүүний  гарз', 0, 13, True),
            (80, '5303', 'Хөрөнгийн дахин үнэлгээний нэмэгдлийн зөрүү', 0, 17, True),
            (81, '5304', 'Гадаад валютын хөрвүүлэлтийн зөрүү', 0, 17, True),
            (82, '5401', 'Үндсэн хөрөнгө данснаас хассаны олз ', 0, 14, True),
            (83, '5402', 'Үндсэн хөрөнгө данснаас хассаны гарз', 0, 14, True),
            (84, '5501', 'Биет бус хөрөнгө данснаас хассаны олз ', 0, 15, True),
            (85, '5502', 'Биет бус хөрөнгө данснаас хассаны гарз', 0, 15, True),
            (86, '5601', 'Хөрөнгө оруулалт борлуулснаас үүссэн  олз ', 0, 16, True),
            (87, '5602', 'Хөрөнгө оруулалт борлуулснаас үүссэн  гарз', 0, 16, True),
            (88, '5701', 'Бусад ашиг ', 0, 17, True),
            (89, '5701', 'Бусад  олз', 0, 0, True),
            (90, '5702', 'Бусад алдагдал', 0, 17, True),
            (91, '5702', 'Бусад  гарз', 0, 0, True),
            (92, '6101', 'Борлуулалтын өртөг', 0, 2, True),
            (93, '6102', 'Борлуулалтын хөнгөлөлт', 0, 2, True),
            (94, '7001', 'Ерөнхий ба удирдлагын зардал', 0, 10, True),
            (95, '7002', 'Даатгалын зардал', 0, 10, True),
            (96, '7003', 'Элэгдлийн зардал /Удирдлагын/', 0, 10, True),
            (97, '7101', 'Борлуулалт, маркетингийн зардал', 0, 9, True),
            (98, '7201', 'Санхүүгийн зардал', 0, 11, True),
            (99, '7202', 'Хүүгийн зардал', 0, 11, True),
            (100, '7401', 'Бусад зардал', 0, 12, True),
            (101, '9101', 'Орлогын татвар зардал', 0, 19, True),
            (102, '9201', 'Орлогын зардлын нэгдсэн данс', 0, 0, True),
        ]

        created_count = 0
        updated_count = 0
        error_count = 0

        for account_type_id, account_type_code, account_type_name, ct1, ct2, is_active in account_types_data:
            try:
                # Check if record already exists
                account_type, created = Ref_Account_Type.objects.get_or_create(
                    AccountTypeId=account_type_id,
                    defaults={
                        'AccountTypeCode': account_type_code,
                        'AccountTypeName': account_type_name,
                        'CT1': ct1,
                        'CT2': ct2,
                        'IsActive': is_active
                    }
                )
                
                if created:
                    created_count += 1
                    self.stdout.write(
                        self.style.SUCCESS(f'Created: {account_type_code} - {account_type_name}')
                    )
                else:
                    # Update existing record
                    account_type.AccountTypeCode = account_type_code
                    account_type.AccountTypeName = account_type_name
                    account_type.CT1 = ct1
                    account_type.CT2 = ct2
                    account_type.IsActive = is_active
                    account_type.save()
                    updated_count += 1
                    self.stdout.write(
                        self.style.WARNING(f'Updated: {account_type_code} - {account_type_name}')
                    )
                    
            except Exception as e:
                error_count += 1
                self.stdout.write(
                    self.style.ERROR(f'Error processing {account_type_code}: {str(e)}')
                )

        # Summary
        self.stdout.write(
            self.style.SUCCESS(
                f'\nMigration completed!\n'
                f'Created: {created_count}\n'
                f'Updated: {updated_count}\n'
                f'Errors: {error_count}\n'
                f'Total processed: {created_count + updated_count + error_count}'
            )
        )
